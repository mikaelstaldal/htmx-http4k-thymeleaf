<!--/*@thymesVar id="model" type="nu.staldal.htmxhttp4kthymeleaf.Contacts2"*/-->
<!DOCTYPE html>
<html lang="en" data-th-replace="~{layout.html :: layout(~{::title/content()}, ~{::extra}, ~{::content})}">
<div data-th-fragment="extra">
    <style>
        tr.htmx-swapping {
            opacity: 0;
            transition: opacity 1s ease-out;
        }
    </style>
    <script>
      function sweetConfirm(elt, config) {
        Swal.fire(config).then((result) => {
          if (result.isConfirmed) elt.dispatchEvent(new Event('confirmed'));
        });
      }
    </script>
</div>
<body>
<h2 data-th-fragment="title">htmx powered Contact.app</h2>
<div data-th-fragment="content">
    <div class="flash" data-th-if="${model.flash}" data-th-text="${model.flash}"/>

    <div class="mb-2">
        <button id="sync-events-btn" class="btn btn-secondary" hx-post="/contacts2/sync-events" hx-target="next span"
                hx-swap="outerHTML">
            Sync contacts from integration with events
        </button>
        <button class="btn btn-light" disabled
                _="on click send htmx:abort to #sync-events-btn
                   on htmx:beforeRequest from #sync-events-btn remove @disabled from me
                   on htmx:afterRequest from #sync-events-btn add @disabled to me">
            Cancel sync
        </button>
        <span></span>
    </div>
    <div class="mb-2">
        <button id="sync-oob-btn" class="btn btn-secondary" hx-post="/contacts2/sync-oob" hx-target="next span"
                hx-swap="outerHTML">
            Sync contacts from integration with out-of-band swap
        </button>
        <button class="btn btn-light" disabled
                _="on click send htmx:abort to #sync-oob-btn
                   on htmx:beforeRequest from #sync-oob-btn remove @disabled from me
                   on htmx:afterRequest from #sync-oob-btn add @disabled to me">
            Cancel sync
        </button>
        <span></span>
    </div>

    <div data-th-insert="~{Contacts2ArchiveUI}"></div>

    <form action="/contacts2" method="get">
        <label for="search">Search Contacts </label>
        <input id="search" type="search" name="q"
               data-th-value="${model.q}?: ''"
               hx-get="/contacts2"
               hx-trigger="search, keyup delay:200ms changed"
               hx-target="tbody"
               hx-push-url="true"
               hx-indicator="next .htmx-indicator"
               _="on keydown[altKey and code is 'KeyS'] from the window
                  focus() me"
        />
        <img class="htmx-indicator"
             width="58" height="58"
             src="/img/spinning-circles.svg"
             alt="Request In Flight..."/>
        <input class="btn btn-primary" type="submit" value="Search"/>
    </form>

    <form id="contacts-form" class="mb-2">
        <table class="table">
            <thead>
            <tr>
                <th></th>
                <th>First</th>
                <th>Last</th>
                <th>Phone</th>
                <th>Email</th>
                <th></th>
            </tr>
            </thead>
            <tbody id="contacts-tbody"
                   hx-get="/contacts2"
                   hx-trigger="contacts-updated from:body"
                   data-th-insert="~{Contacts2Rows}"></tbody>
        </table>
        <button class="btn btn-danger"
                hx-delete="/contacts2"
                hx-target="body"
                hx-trigger="confirmed"
                _="on click(target)
                     halt the event
                     call sweetConfirm(target, {
                        title: 'Delete these contacts?',
                        showCancelButton: true,
                        confirmButtonText: 'Delete'
                     })"
        >Delete selected contacts
        </button>
    </form>
    <p><a class="btn btn-light" href="/contacts2/new">Add Contact</a> (<span hx-get="/contacts2/count"
                                                                             hx-trigger="revealed">
        <img class="htmx-indicator"
             width="58" height="58"
             alt="Request In Flight..."
             src="/img/spinning-circles.svg"/>
    </span> total Contacts)</p>
</div>
</body>
</html>
